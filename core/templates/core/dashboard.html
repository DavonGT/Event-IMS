{% extends 'core/base.html' %}

{% block title %}Events Dashboard{% endblock %}

{% block extra_css %}
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@500&display=swap" rel="stylesheet"/>
  <style>

    .upcoming-events-calendar {
  display: flex;
  justify-content: space-between;
  gap: 24px;
  margin-top: 24px;
  flex-wrap: wrap;
}

/* Upcoming Events Section */
.upcoming {
  flex: 1;
  padding: 16px;
  background-color: #f9e6ff;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(118, 4, 103, 0.1);
}

/* Calendar Section */
.calendar-container {
  flex: 1;
  padding: 16px;
  background-color: #ffffff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  overflow-x: auto;
}

/* Custom header (replaces FullCalendar header) */
.calendar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.calendar-header button {
  background-color: #760467;
  color: #ffffff;
  border: none;
  padding: 6px 14px;
  border-radius: 8px;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.calendar-header button:hover {
  background-color: #a500a5;
}

/* Optional: If you still use a manual calendar grid elsewhere */
.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 12px;
  text-align: center;
}

.calendar-grid div {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 12px;
  border-radius: 8px;
  background-color: #f9e6ff;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.calendar-grid .day-name {
  font-weight: 700;
  background-color: #e6d6f3;
  color: #760467;
}

.calendar-grid .day:hover {
  background-color: #bc52ba;
  color: white;
}

.selected-day {
  background-color: #a500a5;
  color: white;
}

.selected-day:hover {
  background-color: #8b008b;
}

.selected-date {
  margin-top: 16px;
  font-size: 18px;
  color: #5d045d;
  font-weight: bold;
}

  </style>
{% endblock %}

{% block content %}
  <h1>Events Dashboard</h1>

  <div class="dashboard">
    <!-- Dashboard Stats -->
    <div class="dashboard-section">
      <div class="dashboard-header">
        <h2>Quick Stats</h2>
      </div>
      <div class="dashboard-row">
        <div class="dashboard-main">
          <div class="dashboard-body">
            <div class="quick-stats">
              <div class="card">
                <div class="card-header">Upcoming Events</div>
                <div class="card-body">{{ upcoming_events_count }} event{{ upcoming_events_count|pluralize }} this week</div>

              </div>
              <div class="card">
                <div class="card-header">Total Events</div>
                <div class="card-body">125 events this year</div>
              </div>
              <div class="card">
                <div class="card-header">Total Organizations</div>
                <div class="card-body">12 active organizations</div>
              </div>
            </div>
          </div>
        </div>
        <div class="dropdown-container" style="width: 200px; user-select: none;">
          <div class="dropdown-header" id="dropdownHeader">
            <span id="selectedOrgName">Select Organization</span>
            <button class="dropdown-btn" onclick="toggleDropdown(event)">&#9660;</button>
          </div>
          <div class="dropdown-content" id="dropdownMenu">
            <a href="#" onclick="selectOption(event, 'Organization A')">Organization A</a>
            <a href="#" onclick="selectOption(event, 'Organization B')">Organization B</a>
            <a href="#" onclick="selectOption(event, 'Organization C')">Organization C</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <div class="charts">
    <div class="chart">
      <canvas id="barChart"></canvas>
    </div>
    <div class="chart">
      <canvas id="pieChart"></canvas>
    </div>
  </div>

  <div class="upcoming-events-calendar">
    <div class="calendar-upcoming-container" style="display: flex; gap: 2rem; margin-top: 1rem;">
      <div style="flex: 2; min-width: 0;">
        <!-- Custom Header -->
        <div class="calendar-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
          <button id="prevBtn">&#8592;</button>
          <span id="monthYear" style="font-size: 1.2rem; font-weight: bold;"></span>
          <button id="nextBtn">&#8594;</button>
        </div>
        <!-- FullCalendar Target -->
        <div id="calendar"></div>
      </div>
    </div>

  
    <div class="upcoming">
      <h3>Upcoming Events</h3>
      <div class="event-item">
        <div class="event-date">05</div>
        <div class="event-details">
          <strong>Event 1</strong>
          <p>Description for the event goes here.</p>
        </div>
        <button class="view-button">View</button>
      </div>
      <div class="event-item">
        <div class="event-date">12</div>
        <div class="event-details">
          <strong>Event 2</strong>
          <p>Short description for the event.</p>
        </div>
        <button class="view-button">View</button>
      </div>
    </div>
  </div>

    

{% endblock %}

{% block extra_js %}
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- FullCalendar -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

  <script>
    function toggleDropdown(event) {
    event.stopPropagation(); // prevent document click from firing
    const dropdown = document.getElementById('dropdownMenu');
    dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
  }

  function selectOption(event, name) {
    event.preventDefault();
    const selectedOrgName = document.getElementById('selectedOrgName');
    const dropdown = document.getElementById('dropdownMenu');
    selectedOrgName.textContent = name;
    dropdown.style.display = 'none';
  }

  // Close dropdown if clicking outside
  document.addEventListener('click', function() {
    const dropdown = document.getElementById('dropdownMenu');
    if (dropdown.style.display === 'block') {
      dropdown.style.display = 'none';
    }
  });

    // =================== CHARTS ===================
    const barCtx = document.getElementById('barChart').getContext('2d');
    new Chart(barCtx, {
      type: 'bar',
      data: {
        labels: ['Item 1', 'Item 2', 'Item 3', 'Item 4'],
        datasets: [{
          label: 'Last Week',
          data: [10, 15, 20, 30],
          backgroundColor: ['#d9a8ff', '#b368ff', '#a83fff', '#760467']
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        }
      }
    });

    const pieCtx = document.getElementById('pieChart').getContext('2d');
    new Chart(pieCtx, {
      type: 'pie',
      data: {
        labels: ['Item 1', 'Item 2', 'Item 3'],
        datasets: [{
          label: 'Last Week',
          data: [62.5, 25, 12.5],
          backgroundColor: ['#760467', '#c274d8', '#e6d6f3']
        }]
      },
      options: {
        responsive: true
      }
    });

    // =================== CALENDAR ===================
    document.addEventListener('DOMContentLoaded', function () {
      const calendarEl = document.getElementById('calendar');
      const monthYearEl = document.getElementById('monthYear');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');

      // If you're passing events from Django, use this line:
      const eventsData = JSON.parse('{{ events_json|safe }}');

      // FullCalendar instance
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        events: eventsData.map(event => ({
          title: event.name,
          date: event.date,
          extendedProps: {
            description: event.description,
            location: event.location,
            organization: event.organization,
            type: event.type
          }
        })),
        headerToolbar: false, // Disable default header
        navLinks: true,
        dayMaxEvents: 3,
        eventClick: function(info) {
          const e = info.event;
          alert(`üìå ${e.title}\nüìÖ ${e.startStr}\nüìç ${e.extendedProps.location}\nüìù ${e.extendedProps.description}`);
        },
        datesSet: function(info) {
          updateMonthYearTitle(info);
        }
      });

      calendar.render();

      // Update title
      function updateMonthYearTitle(info) {
        const date = new Date(info.view.currentStart);
        const month = date.toLocaleString('default', { month: 'long' });
        const year = date.getFullYear();
        monthYearEl.textContent = `${month} ${year}`;
      }

      // Navigation buttons
      prevBtn.addEventListener('click', function () {
        calendar.prev();
      });

      nextBtn.addEventListener('click', function () {
        calendar.next();
      });
    });
  </script>
{% endblock %}
