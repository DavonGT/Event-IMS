{% extends "core/base.html" %}

{% block title %}All Events{% endblock %}

{% block content %}

<!-- Page Title -->
<div class="title-full">
  <h1 class="page-title">College of Computer Studies Events:</h1>
</div>

<div class="table_container">
  <div class="top-container">
    <!-- Tabs Container -->
    <div class="tabs-container">
      <div class="tabs"> 
        {% for organization in organizations %}
          <a href="{% url 'events_list_filtered' organization.id %}" class="tab {% if organization.id == selected_organization_id %}active{% endif %}">{{ organization.acronym }}</a>
        {% endfor %}
      </div>
    </div>

    <!-- Filter/Search/Add Container -->
    <div class="filter-container">
      <button class="filter-button">Filter</button>
      <input type="text" placeholder="Search..." class="search-input" />
      <a href="{% url 'add_event' %}" class="add-new-button">+ Add New</a>
    </div>
  </div>

  <!-- Events Table -->
  <table class="events-table">
    <thead>
      <tr>
        <th>Event Name</th>
        <th>Date</th>
        <th>Time</th>
        <th>Venue</th>
        <th>Who</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for event in events %}
        <tr>
          <td>{{ event.name }}</td>
          <td>{{ event.start_datetime|date:"d. m. Y" }}</td>
          <td>{{ event.start_datetime|time:"h:i A" }} - {{ event.end_datetime|time:"h:i A" }}</td>
          <td>{{ event.location }}</td>
          <td>
            {% if event.target_group %}
              {{ event.target_group }}
            {% else %}
              {{ event.host.username }}
            {% endif %}
          </td>
          <td>
            <button class="action-link" onclick="openModal('{% url 'view_event' event.id %}')">üîç</button>
            {% if request.user == event.host %}
              <button class="action-link" onclick="openModal('{% url 'edit_event' event.id %}')">‚úèÔ∏è</button>
              <a href="{% url 'delete_event' event.id %}" class="action-link">üóëÔ∏è</a>
            {% endif %}
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="6">No events found.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div id="eventModal" class="custom-modal" style="display: none;">
  <div class="custom-modal-overlay" onclick="closeModal()"></div>
  <div class="custom-modal-content">
    <div class="custom-modal-header">
      <h2 id="modal-title" class="modal-title-text">Loading title...</h2>
      <button class="modal-close" onclick="closeModal()">√ó</button>
    </div>
    <div id="modal-body" class="custom-modal-body">
      Loading...
    </div>
  </div>
</div>




<!-- Modal JS -->
<script>
  function openModal(url) {
    const modal = document.getElementById('eventModal');
    const modalBody = document.getElementById('modal-body');
    const modalTitle = document.getElementById('modal-title');
  
    modal.style.display = 'flex';
    modalBody.innerHTML = 'Loading...';
    modalTitle.textContent = ''; // Clear old title
  
    fetch(url, {
      headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(response => response.text())
    .then(html => {
      // Temporary container to parse the HTML
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = html;
  
      // Try to get event name from a heading tag (or add a hidden tag for it)
      const eventTitle = tempDiv.querySelector('.event-title');
      if (eventTitle) {
        modalTitle.textContent = eventTitle.textContent;
      }
  
      modalBody.innerHTML = html;
    });
  }
  

  function closeModal() {
    document.getElementById('eventModal').style.display = 'none';
  }
</script>

{% endblock %}
